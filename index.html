<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>LIVE</title>
    <script src="https://unpkg.com/peerjs@1.4.7/dist/peerjs.min.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; user-select: none; }
        body { background: #000; color: #fff; font-family: sans-serif; overflow: hidden; height: 100vh; width: 100vw; }
        
        /* Video Full Screen */
        video { width: 100%; height: 100%; object-fit: cover; transform: scaleX(-1); position: absolute; top: 0; left: 0; }

        /* Tombol Host (Kanan Bawah) */
        #btn-host {
            position: absolute; bottom: 20px; right: 20px;
            background: #ffaa00; color: #000;
            border: none; padding: 15px 25px;
            border-radius: 30px; font-weight: bold; font-size: 1rem;
            z-index: 100; cursor: pointer;
            box-shadow: 0 0 10px rgba(255,170,0,0.5);
            animation: pulse 2s infinite;
        }

        /* Tombol Sawer (Kiri Bawah) */
        #btn-sawer {
            position: absolute; bottom: 20px; left: 20px;
            background: #118EEA; color: #fff;
            border: none; padding: 15px 25px;
            border-radius: 30px; font-weight: bold; font-size: 1rem;
            z-index: 100; cursor: pointer;
            display: flex; align-items: center; gap: 8px;
        }

        /* Info Atas */
        .info { position: absolute; top: 20px; left: 20px; background: rgba(0,0,0,0.5); padding: 5px 10px; border-radius: 10px; font-size: 0.8rem; }

        /* Modal Sawer */
        #modal { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.9); z-index: 200; display: none; align-items: center; justify-content: center; }
        .card { background: #222; padding: 30px; border-radius: 20px; text-align: center; width: 80%; border: 1px solid #444; }
        .no-dana { font-size: 2rem; font-weight: bold; color: #118EEA; margin: 10px 0; }
        .tutup { margin-top: 20px; color: #888; text-decoration: underline; cursor: pointer; }

        @keyframes pulse { 0% { transform: scale(1); } 50% { transform: scale(1.05); } 100% { transform: scale(1); } }
    </style>
</head>
<body>

    <video id="v" autoplay playsinline muted></video>

    <!-- INFO JUMLAH PENONTON (FAKE) -->
    <div class="info" id="info">Menyiapkan Kamera...</div>

    <!-- TOMBOL HOST (Hanya muncul untuk Kamu) -->
    <button id="btn-host" style="display:none;" onclick="salinLink()">ðŸ“‹ SALIN LINK KE WA</button>

    <!-- TOMBOL SAWER (Muncul untuk Semua) -->
    <button id="btn-sawer" style="display:none;" onclick="bukaModal()">ðŸ’¸ SAWER</button>

    <!-- MODAL SAWER -->
    <div id="modal">
        <div class="card">
            <h3>Sawer Dana</h3>
            <div class="no-dana" id="dana-num">08123456789</div>
            <button style="padding:10px 20px; border-radius:10px; border:none; background:#118EEA; color:white; cursor:pointer;" onclick="copyDana()">Copy Nomor</button>
            <div class="tutup" onclick="tutupModal()">Tutup</div>
        </div>
    </div>

    <script>
        // GANTI NOMOR DANA DISINI
        const DANA = "08123456789";
        let peer, myStream, peerId;

        const video = document.getElementById('v');
        const btnHost = document.getElementById('btn-host');
        const btnSawer = document.getElementById('btn-sawer');
        const info = document.getElementById('info');
        const modal = document.getElementById('modal');
        const danaDisplay = document.getElementById('dana-num');

        // 1. CEK URL
        const params = new URLSearchParams(window.location.search);
        const watchId = params.get('id'); // Kalau ada ?id=...

        // GANTI NOMOR DANA DI TAMPILAN
        danaDisplay.innerText = DANA;

        // JIKA LINK PUNYA ID (Ini Penonton)
        if (watchId) {
            info.innerText = "Menghubungkan ke Host...";
            join(watchId);
        } 
        // JIKA TIDAK ADA ID (Ini Host / Kamu)
        else {
            info.innerText = "ðŸ”´ LIVE";
            info.style.background = "red";
            btnSawer.style.display = "flex";
            mulaiLive();
        }

        // --- FUNGSI HOST ---
        async function mulaiLive() {
            try {
                myStream = await navigator.mediaDevices.getUserMedia({ video: true, audio: true });
                video.srcObject = myStream;
                video.muted = true; // Kamu matiin suara sendiri

                peer = new Peer();
                peer.on('open', (id) => {
                    peerId = id;
                    btnHost.style.display = "block"; // Munculkan tombol copy
                });

                peer.on('call', (call) => {
                    call.answer(myStream); // Jawab kalau ada yang masuk
                    fakeViewers(); // Mulai fake counter biar keren
                });

            } catch (e) {
                alert("Izin kamera ditolak: " + e);
            }
        }

        // --- FUNGSI PENONTON ---
        function join(hostId) {
            peer = new Peer();
            video.muted = false; // Penonton dengar suara

            peer.on('open', () => {
                const call = peer.call(hostId);
                call.on('stream', (remoteStream) => {
                    video.srcObject = remoteStream; // Tampilkan video host
                    btnSawer.style.display = "flex"; // Penonton bisa sawer
                });
                call.on('close', () => {
                    alert("Host keluar.");
                    location.reload();
                });
            });
        }

        // --- COPY LINK ---
        function salinLink() {
            const link = window.location.href + "?id=" + peerId;
            navigator.clipboard.writeText(link);
            alert("LINK TERSALIN!\nPaste sekarang di WhatsApp ya!");
        }

        // --- FAKE PENONTON ---
        function fakeViewers() {
            let count = 50;
            setInterval(() => {
                count++;
                info.innerText = "ðŸ”´ LIVE â€¢ " + count + " Menonton";
            }, 2000);
        }

        // --- SAWER ---
        function bukaModal() { modal.style.display = 'flex'; }
        function tutupModal() { modal.style.display = 'none'; }
        function copyDana() { 
            navigator.clipboard.writeText(DANA); 
            alert("Nomor disalin!"); 
        }
    </script>
</body>
</html>
